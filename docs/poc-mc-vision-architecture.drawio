<mxfile host="65bd71144e">
    <diagram name="ページ1" id="W4txcq_1rhuCQHbP4cDc">
        <mxGraphModel dx="2530" dy="968" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="user" value="エンドユーザー&#xa;/ フロントエンド" style="ellipse;html=1;whiteSpace=wrap;strokeColor=#2E3A47;strokeWidth=2;fontColor=#2E3A47;fontStyle=1;fillColor=#E8F4F8;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="100" y="160" width="180" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="app-layer" value="アプリケーション層" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#34495E;fillColor=#F6F8FB;fontStyle=1;fontColor=#2E3A47;fontSize=12;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="120" width="380" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="fastapi" value="FastAPI Backend (Lambda Function URL)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2E86C1;strokeWidth=2;fillColor=#FFFFFF;fontColor=#2E3A47;fontStyle=1;fontSize=12;align=left;verticalAlign=top;spacingTop=8;spacingLeft=10;" parent="app-layer" vertex="1">
                    <mxGeometry x="30" y="80" width="320" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="fastapi-note" value="・StepFunctions DescribeExecutionで状態確認&#xa;・Bedrock Guardrailsは環境変数でON/OFF&#xa;・EMFでメトリクス送信" style="text;html=1;strokeColor=#2E86C1;strokeWidth=1;fillColor=#E8F4F8;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=9;" parent="app-layer" vertex="1">
                    <mxGeometry x="150" y="10" width="220" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="aws-cloud" value="AWS Cloud (ap-northeast-1)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#1B3A57;fillColor=#F4F8FC;fontStyle=1;fontColor=#1B3A57;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="380" width="1180" height="730" as="geometry"/>
                </mxCell>
                <mxCell id="aws-core" value="サーバーレス推論基盤" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;strokeColor=#7F8C8D;fillColor=#FFFFFF;fontColor=#2E3A47;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="40" y="40" width="520" height="520" as="geometry"/>
                </mxCell>
                <mxCell id="s3-bucket" value="Amazon S3" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#277116;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.bucket;" parent="aws-core" vertex="1">
                    <mxGeometry x="220" y="50" width="75" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="s3-label" value="poc-mc-vision-upload&#xa;・バージョニング有効&#xa;・暗号化(AES256)&#xa;・Lifecycle 30日" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="305" y="50" width="175" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="lambda-func" value="S3 Logging Lambda" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="220" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="lambda-label" value="poc-mc-vision-handler&lt;br&gt;・S3イベント受信&lt;br&gt;・メタデータをJSONログ出力" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="138" y="220" width="182" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="ddb-table" value="DynamoDB" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#4D27AA;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.dynamodb;" parent="aws-core" vertex="1">
                    <mxGeometry x="220" y="410" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="ddb-label" value="poc-mc-vision-table&#xa;・オンデマンド課金&#xa;・TTL: 1日&#xa;・SSE 有効" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="308" y="410" width="142" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="cloudwatch" value="CloudWatch Logs" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cloudwatch;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="350" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="cloudwatch-label" value="/aws/lambda/*&#xa;保持期間: 1日" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="138" y="350" width="180" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="orchestration" value="オーケストレーション / 監視" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#7F8C8D;fillColor=#F9FBFD;fontColor=#2E3A47;fontStyle=1;fontSize=11;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="600" y="326" width="560" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="step-functions" value="AWS Step Functions" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=11;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.step_functions;" parent="orchestration" vertex="1">
                    <mxGeometry x="30" y="70" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="sns-topic" value="Amazon SNS" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#D82C2C;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=11;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.sns;" parent="orchestration" vertex="1">
                    <mxGeometry x="390" y="70" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="sns-label" value="Topic: poc-mc-vision-alerts&lt;br&gt;用途: CloudWatch Alarms / Pipeline完了通知" style="text;html=1;strokeColor=#F39C12;strokeWidth=1;fillColor=#FFFFFF;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=9;" parent="orchestration" vertex="1">
                    <mxGeometry x="301" y="282" width="180" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="pipeline-worker" value="Lambda: pipeline-worker" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=11;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" parent="orchestration" vertex="1">
                    <mxGeometry x="30" y="165" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="pipeline-worker-note" value="・SFNがタスク(SageMaker, Bedrock, Azure)毎に呼び出す" style="text;html=1;strokeColor=#2E86C1;strokeWidth=1;fillColor=#FFFFFF;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=9;" parent="orchestration" vertex="1">
                    <mxGeometry x="150" y="204" width="240" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="cloudwatch-alarm" value="CloudWatch Alarms" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=11;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cloudwatch;" parent="orchestration" vertex="1">
                    <mxGeometry x="210" y="250" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="ai-services" value="【AI推論サービス】" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#148F77;fillColor=#E8F8F5;fontColor=#148F77;fontStyle=1;fontSize=11;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="600" y="59" width="520" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="sagemaker" value="SageMaker" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#01A88D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.sagemaker;" parent="ai-services" vertex="1">
                    <mxGeometry x="20" y="50" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="sagemaker-label" value="Serverless Endpoint | TorchScript (PyTorch 2.0.1) | Memory: 1024MB / MaxConcurrency: 1" style="text;html=1;strokeColor=#148F77;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=8;" parent="ai-services" vertex="1">
                    <mxGeometry x="95" y="65" width="145" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="bedrock" value="Bedrock" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#01A88D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.bedrock;" parent="ai-services" vertex="1">
                    <mxGeometry x="270" y="50" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="bedrock-label" value="Claude 3 Haiku (Vision) | InvokeModel API" style="text;html=1;strokeColor=#148F77;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=8;" parent="ai-services" vertex="1">
                    <mxGeometry x="345" y="65" width="160" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="guardrail-note" value="Bedrock Guardrails&lt;br&gt;・PII 中レベル / ヘイト / 暴力 / 成人コンテンツをBLOCK&lt;br&gt;・違反時はポリシー違反メッセージを返却" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#5D6D7E;strokeWidth=1;dashed=1;fillColor=#F4F6F6;fontColor=#2E3A47;fontSize=9;" parent="ai-services" vertex="1">
                    <mxGeometry x="260" y="10" width="250" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="iam-note" value="【IAMロール】(Terraform管理)&lt;br&gt;・Lambda: CloudWatch Logs 基本権限&lt;br&gt;・SageMaker: S3 GetObject/ListBucket (モデル配布),&lt;br&gt;　CloudWatch Logs Create/Put" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#C0392B;strokeWidth=2;dashed=1;fillColor=#FEF5F5;fontColor=#C0392B;fontSize=9;fontStyle=1;align=left;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="915" y="219" width="240" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="azure-cloud" value="Azure Cloud (eastus2)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#154360;fillColor=#F4F6FC;fontStyle=1;fontColor=#154360;fontSize=11;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="1560" y="560" width="380" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="azure-rg" value="Resource Group: rg-aoai-poc" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;strokeColor=#5DADE2;fillColor=#FFFFFF;fontColor=#154360;fontSize=10;align=left;verticalAlign=top;spacingTop=8;spacingLeft=8;" parent="azure-cloud" vertex="1">
                    <mxGeometry x="20" y="30" width="340" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="azure-aoai" value="Azure OpenAI" style="sketch=0;aspect=fixed;html=1;points=[];align=center;image;fontSize=12;fontStyle=1;image=img/lib/azure2/ai_machine_learning/Cognitive_Services.svg;fontColor=#154360;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;" parent="azure-rg" vertex="1">
                    <mxGeometry x="20" y="40" width="58" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="azure-aoai-label" value="aoai-poc-vision-eastus2 | gpt-4o-mini (2024-07-18) | SKU: S0 / Standard" style="text;html=1;strokeColor=#5DADE2;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#154360;fontSize=8;" parent="azure-rg" vertex="1">
                    <mxGeometry x="88" y="48" width="240" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="edge-user-fastapi" value="① 画像解析リクエスト" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="user" target="fastapi" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint y="-25" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-fastapi-s3" value="② 署名付きURL発行" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint y="-20" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-user-s3" value="③ 画像アップロード" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="user" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint y="25" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-fastapi-sfn" value="④ パイプライン開始" style="endArrow=block;html=1;strokeColor=#8C4FFF;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="step-functions" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint y="-30" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-fastapi-ddb" value="⑥ 結果をDB保存" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="step-functions" target="ddb-table" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="30" y="-40" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-sfn-sns" value="⑦ 完了/失敗を通知" style="endArrow=block;html=1;strokeColor=#D35400;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="step-functions" target="sns-topic" edge="1">
                    <mxGeometry x="0.3077" y="-9" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-sfn-invokes-worker" value="⑤ Worker呼び出し (タスク毎)" style="endArrow=block;html=1;strokeColor=#8C4FFF;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="step-functions" target="pipeline-worker" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-worker-gets-object" value="⑤-A 画像取得" style="endArrow=block;html=1;strokeColor=#277116;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="pipeline-worker" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-worker-calls-sagemaker" value="⑤-B 推論リクエスト" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="pipeline-worker" target="sagemaker" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-worker-calls-bedrock" value="⑤-B 推論リクエスト" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="pipeline-worker" target="bedrock" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-worker-calls-azure" value="⑤-B 推論リクエスト" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="pipeline-worker" target="azure-aoai" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-user-gets-result" value="⑧ 結果取得リクエスト" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;dashed=1;" parent="1" source="user" target="fastapi" edge="1">
                    <mxGeometry y="30" relative="1" as="geometry">
                        <mxPoint x="-40" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-fastapi-gets-result" value="結果をDBから取得" style="endArrow=block;html=1;strokeColor=#4D27AA;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="ddb-table" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>