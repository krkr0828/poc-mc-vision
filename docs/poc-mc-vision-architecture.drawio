<mxfile host="65bd71144e">
    <diagram name="ページ1" id="W4txcq_1rhuCQHbP4cDc">
        <mxGraphModel dx="1536" dy="684" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="user" value="エンドユーザー&#xa;/ フロントエンド" style="ellipse;html=1;whiteSpace=wrap;strokeColor=#2E3A47;strokeWidth=2;fontColor=#2E3A47;fontStyle=1;fillColor=#E8F4F8;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="100" y="160" width="180" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="app-layer" value="アプリケーション層" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#34495E;fillColor=#F6F8FB;fontStyle=1;fontColor=#2E3A47;fontSize=12;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="120" width="380" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="fastapi" value="FastAPI Backend" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2E86C1;strokeWidth=2;fillColor=#FFFFFF;fontColor=#2E3A47;fontStyle=1;fontSize=12;align=left;verticalAlign=top;spacingTop=8;spacingLeft=10;" parent="app-layer" vertex="1">
                    <mxGeometry x="30" y="80" width="320" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="fastapi-note" value="・リクエスト受付 / 認証&#xa;・S3 Presigned URL / GetObject&#xa;・AI推論サービス呼び出し&#xa;・結果をDynamoDBへ保存" style="text;html=1;strokeColor=#2E86C1;strokeWidth=1;fillColor=#E8F4F8;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=10;" parent="app-layer" vertex="1">
                    <mxGeometry x="150" y="30" width="180" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="aws-cloud" value="AWS Cloud (ap-northeast-1)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#1B3A57;fillColor=#F4F8FC;fontStyle=1;fontColor=#1B3A57;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="380" width="1180" height="620" as="geometry"/>
                </mxCell>
                <mxCell id="aws-core" value="サーバーレス推論基盤" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;strokeColor=#7F8C8D;fillColor=#FFFFFF;fontColor=#2E3A47;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="40" y="40" width="520" height="520" as="geometry"/>
                </mxCell>
                <mxCell id="s3-bucket" value="Amazon S3" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#277116;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.bucket;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="50" width="75" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="s3-label" value="poc-mc-vision-upload&#xa;・バージョニング有効&#xa;・暗号化(AES256)&#xa;・Lifecycle 30日" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="135" y="50" width="175" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="lambda-func" value="AWS Lambda" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="170" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="lambda-label" value="poc-mc-vision-handler&lt;br&gt;・S3イベント受信&lt;br&gt;・メタデータをJSONログ出力" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="138" y="170" width="182" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="ddb-table" value="DynamoDB" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#4D27AA;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.dynamodb;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="290" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="ddb-label" value="poc-mc-vision-table&#xa;・オンデマンド課金&#xa;・TTL: 1日&#xa;・SSE 有効" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="138" y="290" width="142" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="cloudwatch" value="CloudWatch" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cloudwatch;" parent="aws-core" vertex="1">
                    <mxGeometry x="50" y="410" width="78" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="cloudwatch-label" value="/aws/lambda/&#xa;poc-mc-vision-handler&#xa;保持期間: 1日" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontColor=#2E3A47;fontSize=11;" parent="aws-core" vertex="1">
                    <mxGeometry x="138" y="410" width="142" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="note-s3" value="FastAPI 側では Presigned URL を発行しアップロードを受け付ける。&#xa;推論実行時は S3 から get_object で画像を取得して AI サービスへ渡す。" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#7F8C8D;strokeWidth=1;dashed=1;fillColor=#FEFAF0;fontColor=#2E3A47;fontSize=10;" parent="aws-core" vertex="1">
                    <mxGeometry x="330" y="50" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="ai-services" value="【AI推論サービス】FastAPIから順次呼び出し（⑤-A/B/C）" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#148F77;fillColor=#E8F8F5;fontColor=#148F77;fontStyle=1;fontSize=11;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="600" y="180" width="520" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="sagemaker" value="SageMaker" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#01A88D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.sagemaker;" parent="ai-services" vertex="1">
                    <mxGeometry x="20" y="50" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="sagemaker-label" value="Serverless Endpoint | TorchScript (PyTorch 2.0.1) | Memory: 1024MB / MaxConcurrency: 1" style="text;html=1;strokeColor=#148F77;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=8;" parent="ai-services" vertex="1">
                    <mxGeometry x="95" y="65" width="145" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="bedrock" value="Bedrock" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#01A88D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.bedrock;" parent="ai-services" vertex="1">
                    <mxGeometry x="270" y="50" width="68" height="68" as="geometry"/>
                </mxCell>
                <mxCell id="bedrock-label" value="Claude 3 Haiku (Vision) | InvokeModel API" style="text;html=1;strokeColor=#148F77;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#2E3A47;fontSize=8;" parent="ai-services" vertex="1">
                    <mxGeometry x="345" y="65" width="160" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="note-flows" value="【処理フロー】&#xa;①-④: ユーザーリクエスト・画像アップロード&#xa;⑤-A/B/C: AI推論（順次実行）&#xa;⑥: 結果保存 | Ａ1-Ａ2: 監査ログ" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#148F77;strokeWidth=2;dashed=1;fillColor=#E8F8F5;fontColor=#148F77;fontSize=10;fontStyle=1;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="600" y="340" width="260" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="iam-note" value="【IAMロール】(Terraform管理)&lt;br&gt;・Lambda: CloudWatch Logs 基本権限&lt;br&gt;・SageMaker: S3 GetObject/ListBucket (モデル配布),&lt;br&gt;　CloudWatch Logs Create/Put" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#C0392B;strokeWidth=2;dashed=1;fillColor=#FEF5F5;fontColor=#C0392B;fontSize=9;fontStyle=1;align=left;" parent="aws-cloud" vertex="1">
                    <mxGeometry x="880" y="340" width="240" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="azure-cloud" value="Azure Cloud (eastus2)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#154360;fillColor=#F4F6FC;fontStyle=1;fontColor=#154360;fontSize=11;align=left;verticalAlign=top;spacingTop=10;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="1560" y="560" width="380" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="azure-rg" value="Resource Group: rg-aoai-poc" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;strokeColor=#5DADE2;fillColor=#FFFFFF;fontColor=#154360;fontSize=10;align=left;verticalAlign=top;spacingTop=8;spacingLeft=8;" parent="azure-cloud" vertex="1">
                    <mxGeometry x="20" y="30" width="340" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="azure-aoai" value="Azure OpenAI" style="sketch=0;aspect=fixed;html=1;points=[];align=center;image;fontSize=12;fontStyle=1;image=img/lib/azure2/ai_machine_learning/Cognitive_Services.svg;fontColor=#154360;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;" parent="azure-rg" vertex="1">
                    <mxGeometry x="20" y="40" width="58" height="42" as="geometry"/>
                </mxCell>
                <mxCell id="azure-aoai-label" value="aoai-poc-vision-eastus2 | gpt-4o-mini (2024-07-18) | SKU: S0 / Standard" style="text;html=1;strokeColor=#5DADE2;strokeWidth=1;fillColor=#FFFFFF;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontColor=#154360;fontSize=8;" parent="azure-rg" vertex="1">
                    <mxGeometry x="88" y="48" width="240" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="edge-user-fastapi" value="① HTTPS リクエスト&#xa;画像解析要求" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="user" target="fastapi" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-s3" value="② Presigned URL 発行" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-user-s3" value="③ 画像アップロード" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="user" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-s3-get" value="④ S3から画像取得" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="s3-bucket" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-sagemaker" value="⑤-A SageMaker推論&#xa;（順次呼び出し）" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="sagemaker" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-bedrock" value="⑤-B Bedrock推論&#xa;（順次呼び出し）" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="bedrock" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-azure" value="⑤-C Azure OpenAI推論&#xa;（順次呼び出し）" style="endArrow=block;html=1;strokeColor=#148F77;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="azure-aoai" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="edge-fastapi-ddb" value="⑥ 推論結果保存" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="fastapi" target="ddb-table" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="30" y="-40" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-s3-lambda" value="Ａ1 S3イベント" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="s3-bucket" target="lambda-func" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint y="-35" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="edge-lambda-logs" value="Ａ2 ログ出力" style="endArrow=block;html=1;strokeColor=#2E3A47;strokeWidth=2;rounded=1;edgeStyle=orthogonalEdgeStyle;labelBackgroundColor=#FFFFFF;fontSize=10;" parent="1" source="lambda-func" target="cloudwatch" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>